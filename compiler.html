<html>
<head>

<link rel="stylesheet" href="js/plugins/CodeMirror/lib/codemirror.css">
<link rel="stylesheet" href="js/plugins/jquery-ui-1.11.2.custom/jquery-ui.css">
<link rel="stylesheet" href="js/plugins/jquery-ui-1.11.2.custom/jquery-ui.theme.css">
<link rel="stylesheet" href="js/plugins/CodeMirror/doc/docs.css">
<link rel="stylesheet" href="js/plugins/CodeMirror/addon/hint/show-hint.css">
<link rel="stylesheet" href="js/plugins/CodeMirror/addon/display/fullscreen.css">
<link rel="stylesheet" href="js/plugins/CodeMirror/addon/lint/lint.css">
<link rel="stylesheet" href="js/plugins/CodeMirror/addon/dialog/dialog.css">
<link rel="stylesheet" href="js/plugins/CodeMirror/addon/search/matchesonscrollbar.css">
<link rel="stylesheet" href="js/plugins/CodeMirror/theme/xq-light.css">
<script>
(function(g,b,d){var c=b.head||b.getElementsByTagName("head"),D="readyState",E="onreadystatechange",F="DOMContentLoaded",G="addEventListener",H=setTimeout;
function f(){

	 
// ***************************************************************
// *********************** $LAB stuff ****************************
// ***************************************************************
$LAB.script("js/jquery-2.1.1.js").wait() 
        .script("js/autobahn.js").wait() 
    	.script("js/diy_js.js").wait() 
    	.script("js/plugins/jquery-ui-1.11.2.custom/jquery-ui.js").wait() 
	.script("js/plugins/CodeMirror/lib/codemirror.js").wait() 
	.script("js/plugins/CodeMirror/mode/clike/clike.js").wait() 
	.script("js/plugins/CodeMirror/addon/edit/matchbrackets.js").wait() 
	.script("js/plugins/CodeMirror/addon/comment/comment.js").wait() 
	.script("js/plugins/CodeMirror/addon/search/search.js").wait() 
	.script("js/plugins/CodeMirror/addon/search/searchcursor.js").wait() 
	.script("js/plugins/CodeMirror/addon/dialog/dialog.js").wait() 
	.script("js/plugins/CodeMirror/addon/scroll/annotatescrollbar.js").wait() 
	.script("js/plugins/CodeMirror/addon/search/matchesonscrollbar.js").wait() 
	.script("js/plugins/CodeMirror/addon/display/fullscreen.js").wait() 
	.script("js/plugins/CodeMirror/addon/hint/anyword-hint.js").wait() 
	.script("js/plugins/CodeMirror/addon/hint/show-hint.js") 

	.script("js/plugins/CodeMirror/addon/lint/lint.js")
	.script("js/plugins/CodeMirror/mode/css/css.js")
	.script("js/plugins/CodeMirror/addon/lint/javascript-lint.js")
	.script("js/plugins/CodeMirror/mode/javascript/javascript.js")
	.script("js/plugins/CodeMirror/addon/lint/json-lint.js") 
	.script("js/plugins/CodeMirror/addon/lint/css-lint.js")
	.script("js/plugins/CodeMirror/addon/selection/active-line.js")
	//.script("http://ajax.aspnetcdn.com/ajax/jshint/r07/jshint.js").wait() 
	.script("js/plugins/CodeMirror/addon/lint/jshint.js") 
	//.script("https://rawgithub.com/zaach/jsonlint/79b553fb65c192add9066da64043458981b3972b/lib/jsonlint.js").wait() 
	.script("js/plugins/CodeMirror/addon/lint/jsonlint.js")
	.script("js/plugins/CodeMirror/addon/lint/csslint.js").wait() 
	//.script("https://rawgithub.com/stubbornella/csslint/master/release/csslint.js").wait() 

        .wait(function(){
                // ***************************************************************
                // *********************** scripts ok  ***************************
                // ***************************************************************
         	AUTOBAHN_DEBUG = true;
 		ab.debug(true);
 		var diy_o =  new diy_tools();
					//name: "text/x-csrc", 
        	$(function(){   
			var editor = CodeMirror.fromTextArea(document.getElementById("code"), {
				mode: { 
					name: "javascript", 
					globalVars: true
				},
				lint: true,
				lineNumbers: true,
				theme: "default",
				tabMode: "indent",
				gutters: ["CodeMirror-lint-markers"],
				matchBrackets: true,
				onBlur: function(){
					editor.save();
				},
				onChange: function(){
					$("#changeimg").show();
				}, 
				extraKeys: {
					'Cmd-/' : 'toggleComment',
					'Ctrl-/' : 'toggleComment',
					"Ctrl-Space": "autocomplete",
				        "F11": function(cm) {
				        	cm.setOption("fullScreen", !cm.getOption("fullScreen"));
				        },
					"Esc": function(cm) {
						if (cm.getOption("fullScreen")) 
							cm.setOption("fullScreen", false);
					}
				},
				path: 'js/', 
				searchMode: 'inline',
				onCursorActivity: function () {
					editor.setLineClass(hlLine, null);
					hlLine = editor.setLineClass(editor.getCursor().line, "activeline");
				}
			});
			$(document).on('click', '#save', function() {
				console.log(editor.getValue());
			});
			$(document).on('click', '#load', function() {
				editor.setValue(data);
			});
			$(document).on('click', '#add_file', function() {
				 dialog.dialog( "open" );
			 });
			  var dialog = $( "#dialog" ).dialog({
				  autoOpen: false,
				  modal: true,
				  buttons: {
					  Add: function() {
						  addTab();
						  $( this ).dialog( "close" );
					  },
					  Cancel: function() {
						  $( this ).dialog( "close" );
					  }
				  },
				  close: function() {
					  form[ 0 ].reset();
				  }
			  });
			var data='var widgets = [] \n function updateHints() { \n editor.operation(function(){ \n for (var i = 0; i < widgets.length; ++i) \n editor.removeLineWidget(widgets[i]); \n widgets.length = 0; \n \n JSHINT(editor.getValue()); \n for (var i = 0; i < JSHINT.errors.length; ++i) {\n var err = JSHINT.errors[i]; \n if (!err) continue; \n var msg = document.createElement("div"); \n var icon = msg.appendChild(document.createElement("span")); \n icon.innerHTML = "!!"; \n icon.className = "lint-error-icon"; \n msg.appendChild(document.createTextNode(err.reason)); \n msg.className = "lint-error"; \n widgets.push(editor.addLineWidget(err.line - 1, msg, {coverGutter: false, noHScroll: true})); \n } \n }); \n var info = editor.getScrollInfo(); \n var after = editor.charCoords({line: editor.getCursor().line + 1, ch: 0}, "local").top; \n if (info.top + info.clientHeight < after) \n editor.scrollTo(null, after - info.clientHeight + 3); \n } \n ';


			$( "#tabs" ).tabs();


			// Check for the various File API support.
			if (window.File && window.FileReader && window.FileList && window.Blob) {



				// Create Base64 Object
				var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t="";var n,r,i,s,o,u,a;var f=0;e=Base64._utf8_encode(e);while(f<e.length){n=e.charCodeAt(f++);r=e.charCodeAt(f++);i=e.charCodeAt(f++);s=n>>2;o=(n&3)<<4|r>>4;u=(r&15)<<2|i>>6;a=i&63;if(isNaN(r)){u=a=64}else if(isNaN(i)){a=64}t=t+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(u)+this._keyStr.charAt(a)}return t},decode:function(e){var t="";var n,r,i;var s,o,u,a;var f=0;e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(f<e.length){s=this._keyStr.indexOf(e.charAt(f++));o=this._keyStr.indexOf(e.charAt(f++));u=this._keyStr.indexOf(e.charAt(f++));a=this._keyStr.indexOf(e.charAt(f++));n=s<<2|o>>4;r=(o&15)<<4|u>>2;i=(u&3)<<6|a;t=t+String.fromCharCode(n);if(u!=64){t=t+String.fromCharCode(r)}if(a!=64){t=t+String.fromCharCode(i)}}t=Base64._utf8_decode(t);return t},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");var t="";for(var n=0;n<e.length;n++){var r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r)}else if(r>127&&r<2048){t+=String.fromCharCode(r>>6|192);t+=String.fromCharCode(r&63|128)}else{t+=String.fromCharCode(r>>12|224);t+=String.fromCharCode(r>>6&63|128);t+=String.fromCharCode(r&63|128)}}return t},_utf8_decode:function(e){var t="";var n=0;var r=c1=c2=0;while(n<e.length){r=e.charCodeAt(n);if(r<128){t+=String.fromCharCode(r);n++}else if(r>191&&r<224){c2=e.charCodeAt(n+1);t+=String.fromCharCode((r&31)<<6|c2&63);n+=2}else{c2=e.charCodeAt(n+1);c3=e.charCodeAt(n+2);t+=String.fromCharCode((r&15)<<12|(c2&63)<<6|c3&63);n+=3}}return t}}




function handleFileSelect(evt) {
	var files = evt.target.files; // FileList object

	// Loop through the FileList and render image files as thumbnails.
	for (var i = 0, f; f = files[i]; i++) {
		// Only process image files.
		//if (!f.type.match('image.*')) {
		//	continue;
		//}
		var reader = new FileReader();
		// Closure to capture the file information.
		reader.onload = (function(theFile) {
			return function(e) {
				 editor.setValue(e.target.result);
			};
		})(f);

		// Read in the image file as a data URL.
		reader.readAsText(f);
	}
}


document.getElementById('files').addEventListener('change', handleFileSelect, false);



				  // Great success! All the File APIs are supported.
				  } else {
				    alert('The File APIs are not fully supported in this browser.');
			    }




  		});

                // ***************************************************************
                // *********************** scripts ok  ***************************
                // ***************************************************************
        });
// ***************************************************************
// *********************** $LAB stuff  ***************************
// ***************************************************************

}
H(function(){if("item"in c){if(!c[0]){H(arguments.callee,25);return}c=c[0]}var a=b.createElement("script"),e=false;a.onload=a[E]=function(){if((a[D]&&a[D]!=="complete"&&a[D]!=="loaded")||e){return false}a.onload=a[E]=null;e=true;f()};
a.src="js/LAB.js";
c.insertBefore(a,c.firstChild)},0);if(b[D]==null&&b[G]){b[D]="loading";b[G](F,d=function(){b.removeEventListener(F,d,false);b[D]="complete"},false)}})(this,document);


</script>

</head>
<body>
	<div id="devices" class="devices">
	</div>
	<div id="myTextAreadiv" class="myTextAreadiv">
		<p>The keybindings are:</p>
		<dl>
			<dt>Ctrl-F / Cmd-F</dt><dd>Start searching</dd>
			<dt>Ctrl-G / Cmd-G</dt><dd>Find next</dd>
			<dt>Shift-Ctrl-G / Shift-Cmd-G</dt><dd>Find previous</dd>
			<dt>Shift-Ctrl-F / Cmd-Option-F</dt><dd>Replace</dd>
			<dt>Shift-Ctrl-R / Shift-Cmd-Option-F</dt><dd>Replace all</dd>
			Press F11 when cursor is in the editor to toggle full screen editing.<br> 
			Esc can also be used to exit full screen editi
			<div id="save">save</div>
			<div id="load">save</div>
		</dl>
	</div>	
	<button id="add_file">Add File</button>
				<input type="file" id="files" name="files[]" multiple />
				<output id="list"></output>
	<div id="tabs">
		<ul>
			<li>Tab 1</li>
			<li>Tab 2</li>
		</ul>
		<div>
			<textarea id="code" cols="150" rows="50"></textarea>
		</div>
	</div>
	<div id="dataDev" class="dataDev">
	</div>
	<div id="dialog" title="Tab data"></div>
</body>
</html>
